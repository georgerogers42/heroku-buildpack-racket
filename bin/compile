#! /bin/sh
set -e

BUILD_DIR=$1
CACHE_DIR=$2

RACKET_URL="http://mirror.racket-lang.org/installers/6.1.1/racket-6.1.1-src.tgz"
RACKET_VERSION=6.1.1

indent() {
  sed -u 's/^/       /'
}

echo "-----> Building Racket Runtime Environment"

if [ ! -e $CACHE_DIR ]; then
  mkdir $CACHE_DIR
  cd $CACHE_DIR
else
  cd $CACHE_DIR
  rm -rf racket
fi
curl -L $RACKET_URL | tar xzv
RACKET_DIR=$CACHE_DIR/racket
cd racket-$RACKET_VERSION/src
./configure --prefix $RACKET_DIR
make install

echo "-----> Creating racket exe From heroku-setup.rkt"
cd $BUILD_DIR
$RACKET_DIR/bin/raco exe heroku-setup.rkt
$RACKET_DIR/bin/raco distribute run heroku-setup
