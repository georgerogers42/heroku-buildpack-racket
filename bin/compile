#! /bin/sh

BUILD_DIR=$1
CACHE_DIR=$2

RACKET_URL=http://download.racket-lang.org/installers/5.3.6/racket/racket-5.3.6-bin-x86_64-linux-debian-squeeze.sh
RACKET_VERSION=v5.3.6

MAKEOPTS=-j3


indent() {
  sed -u 's/^/       /'
}

echo "-----> Building Racket Runtime Environment"

mkdir $CACHE_DIR
cd $CACHE_DIR
curl -L $RACKET_URL > racket-installer
chmod u+x racket-installer
./racket-installer <<options
no
4
no
yes
options
RACKET_DIR=$CACHE_DIR/racket
cp -r $RACKET_DIR /app

echo "-----> Creating racketapp From heroku-setup.rkt"
cd $BUILD_DIR
$RACKET_DIR/bin/raco exe heroku-setup.rkt
$RACKET_DIR/bin/raco distribute run heroku-setup
